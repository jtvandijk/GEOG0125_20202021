<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>9 Web Visualisation | GEOG0125: Advanced Topics in Social and Geographic Data Science</title>
  <meta name="description" content="9 Web Visualisation | GEOG0125: Advanced Topics in Social and Geographic Data Science." />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="9 Web Visualisation | GEOG0125: Advanced Topics in Social and Geographic Data Science" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://jtvandijk.github.io/GEOG0125_20202021/" />
  
  <meta property="og:description" content="9 Web Visualisation | GEOG0125: Advanced Topics in Social and Geographic Data Science." />
  <meta name="github-repo" content="jtvandijk/GEOG0125_20202021" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="9 Web Visualisation | GEOG0125: Advanced Topics in Social and Geographic Data Science" />
  
  <meta name="twitter:description" content="9 Web Visualisation | GEOG0125: Advanced Topics in Social and Geographic Data Science." />
  

<meta name="author" content="Justin van Dijk and Stephen Law" />


<meta name="date" content="2021-08-03" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="unix-tools.html"/>
<link rel="next" href="a-look-into-the-future.html"/>
<script src="libs/header-attrs-2.5/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>
<link href="libs/vembedr-0.1.4/css/vembedr.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="assets/custom.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="toc-logo">
<a href="https://www.ucl.ac.uk/module-catalogue/modules/advanced-topics-in-social-data-science-GEOG0125"><img src="images/general/ucl_logo.png">
</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#weekly-topics"><i class="fa fa-check"></i>Weekly topics</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#moodle"><i class="fa fa-check"></i>Moodle</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#useful-additional-resources"><i class="fa fa-check"></i>Useful additional resources</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#office-hours"><i class="fa fa-check"></i>Office hours</a></li>
</ul></li>
<li class="part"><span><b>Introduction</b></span></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="part"><span><b>Inference</b></span></li>
<li class="chapter" data-level="2" data-path="statistical-inference-and-causality.html"><a href="statistical-inference-and-causality.html"><i class="fa fa-check"></i><b>2</b> Statistical Inference and Causality</a>
<ul>
<li class="chapter" data-level="2.1" data-path="statistical-inference-and-causality.html"><a href="statistical-inference-and-causality.html#intro-w09"><i class="fa fa-check"></i><b>2.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="statistical-inference-and-causality.html"><a href="statistical-inference-and-causality.html#reading-list-w01"><i class="fa fa-check"></i><b>2.1.1</b> Reading list</a></li>
<li class="chapter" data-level="2.1.2" data-path="statistical-inference-and-causality.html"><a href="statistical-inference-and-causality.html#technical-help-session"><i class="fa fa-check"></i><b>2.1.2</b> Technical Help session</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="statistical-inference-and-causality.html"><a href="statistical-inference-and-causality.html#statistical-inference"><i class="fa fa-check"></i><b>2.2</b> Statistical inference</a></li>
<li class="chapter" data-level="2.3" data-path="statistical-inference-and-causality.html"><a href="statistical-inference-and-causality.html#causality"><i class="fa fa-check"></i><b>2.3</b> Causality</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="statistical-inference-and-causality.html"><a href="statistical-inference-and-causality.html#what-is-causality"><i class="fa fa-check"></i><b>2.3.1</b> What is causality?</a></li>
<li class="chapter" data-level="2.3.2" data-path="statistical-inference-and-causality.html"><a href="statistical-inference-and-causality.html#the-problem-with-causality"><i class="fa fa-check"></i><b>2.3.2</b> The problem with causality</a></li>
<li class="chapter" data-level="2.3.3" data-path="statistical-inference-and-causality.html"><a href="statistical-inference-and-causality.html#fixed-effects-models"><i class="fa fa-check"></i><b>2.3.3</b> Fixed effects models</a></li>
<li class="chapter" data-level="2.3.4" data-path="statistical-inference-and-causality.html"><a href="statistical-inference-and-causality.html#random-effects-models"><i class="fa fa-check"></i><b>2.3.4</b> Random effects models</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="statistical-inference-and-causality.html"><a href="statistical-inference-and-causality.html#thm-w02"><i class="fa fa-check"></i><b>2.4</b> Take home message</a></li>
<li class="chapter" data-level="2.5" data-path="statistical-inference-and-causality.html"><a href="statistical-inference-and-causality.html#attributions_w02"><i class="fa fa-check"></i><b>2.5</b> Attributions</a></li>
</ul></li>
<li class="part"><span><b>GeoAI</b></span></li>
<li class="chapter" data-level="3" data-path="introduction-to-deep-learning.html"><a href="introduction-to-deep-learning.html"><i class="fa fa-check"></i><b>3</b> Introduction to Deep Learning</a></li>
<li class="chapter" data-level="4" data-path="keynote-spatial-data-science.html"><a href="keynote-spatial-data-science.html"><i class="fa fa-check"></i><b>4</b> Keynote: Spatial Data Science</a></li>
<li class="chapter" data-level="5" data-path="convolutional-neural-networks.html"><a href="convolutional-neural-networks.html"><i class="fa fa-check"></i><b>5</b> Convolutional Neural Networks</a></li>
<li class="chapter" data-level="6" data-path="spatial-data-science-applications.html"><a href="spatial-data-science-applications.html"><i class="fa fa-check"></i><b>6</b> Spatial Data Science Applications</a></li>
<li class="chapter" data-level="7" data-path="spatial-temporal-mobility-analysis.html"><a href="spatial-temporal-mobility-analysis.html"><i class="fa fa-check"></i><b>7</b> Spatial-Temporal Mobility Analysis</a>
<ul>
<li class="chapter" data-level="7.1" data-path="spatial-temporal-mobility-analysis.html"><a href="spatial-temporal-mobility-analysis.html#intro-w07"><i class="fa fa-check"></i><b>7.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="spatial-temporal-mobility-analysis.html"><a href="spatial-temporal-mobility-analysis.html#reading-list-w07"><i class="fa fa-check"></i><b>7.1.1</b> Reading list</a></li>
<li class="chapter" data-level="7.1.2" data-path="statistical-inference-and-causality.html"><a href="statistical-inference-and-causality.html#technical-help-session"><i class="fa fa-check"></i><b>7.1.2</b> Technical Help session</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="spatial-temporal-mobility-analysis.html"><a href="spatial-temporal-mobility-analysis.html#gps-data"><i class="fa fa-check"></i><b>7.2</b> GPS data</a></li>
<li class="chapter" data-level="7.3" data-path="spatial-temporal-mobility-analysis.html"><a href="spatial-temporal-mobility-analysis.html#gps-data-classification"><i class="fa fa-check"></i><b>7.3</b> GPS data classification</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="spatial-temporal-mobility-analysis.html"><a href="spatial-temporal-mobility-analysis.html#gps-data-preparation"><i class="fa fa-check"></i><b>7.3.1</b> GPS data preparation</a></li>
<li class="chapter" data-level="7.3.2" data-path="spatial-temporal-mobility-analysis.html"><a href="spatial-temporal-mobility-analysis.html#gps-data-classification-1"><i class="fa fa-check"></i><b>7.3.2</b> GPS data classification</a></li>
<li class="chapter" data-level="7.3.3" data-path="spatial-temporal-mobility-analysis.html"><a href="spatial-temporal-mobility-analysis.html#exercise"><i class="fa fa-check"></i><b>7.3.3</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="spatial-temporal-mobility-analysis.html"><a href="spatial-temporal-mobility-analysis.html#thm_w07"><i class="fa fa-check"></i><b>7.4</b> Take home message</a></li>
<li class="chapter" data-level="7.5" data-path="spatial-temporal-mobility-analysis.html"><a href="spatial-temporal-mobility-analysis.html#attributions_w07"><i class="fa fa-check"></i><b>7.5</b> Attributions</a></li>
</ul></li>
<li class="part"><span><b>Data Sciencist’s Toolbox</b></span></li>
<li class="chapter" data-level="8" data-path="unix-tools.html"><a href="unix-tools.html"><i class="fa fa-check"></i><b>8</b> Unix Tools</a>
<ul>
<li class="chapter" data-level="8.1" data-path="unix-tools.html"><a href="unix-tools.html#intro-w08"><i class="fa fa-check"></i><b>8.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="unix-tools.html"><a href="unix-tools.html#reading-list-w08"><i class="fa fa-check"></i><b>8.1.1</b> Reading list</a></li>
<li class="chapter" data-level="8.1.2" data-path="statistical-inference-and-causality.html"><a href="statistical-inference-and-causality.html#technical-help-session"><i class="fa fa-check"></i><b>8.1.2</b> Technical Help session</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="unix-tools.html"><a href="unix-tools.html#unix-shell"><i class="fa fa-check"></i><b>8.2</b> Unix Shell</a></li>
<li class="chapter" data-level="8.3" data-path="unix-tools.html"><a href="unix-tools.html#bourne-again-shell-bash"><i class="fa fa-check"></i><b>8.3</b> Bourne Again SHell (BASH)</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="unix-tools.html"><a href="unix-tools.html#installation"><i class="fa fa-check"></i><b>8.3.1</b> Installation</a></li>
<li class="chapter" data-level="8.3.2" data-path="unix-tools.html"><a href="unix-tools.html#getting-started"><i class="fa fa-check"></i><b>8.3.2</b> Getting started</a></li>
<li class="chapter" data-level="8.3.3" data-path="spatial-temporal-mobility-analysis.html"><a href="spatial-temporal-mobility-analysis.html#exercise"><i class="fa fa-check"></i><b>8.3.3</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="unix-tools.html"><a href="unix-tools.html#text-editing"><i class="fa fa-check"></i><b>8.4</b> Text editing</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="unix-tools.html"><a href="unix-tools.html#exercise-1"><i class="fa fa-check"></i><b>8.4.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="unix-tools.html"><a href="unix-tools.html#data-wrangling"><i class="fa fa-check"></i><b>8.5</b> Data wrangling</a></li>
<li class="chapter" data-level="8.6" data-path="unix-tools.html"><a href="unix-tools.html#copying-data"><i class="fa fa-check"></i><b>8.6</b> Copying data</a></li>
<li class="chapter" data-level="8.7" data-path="unix-tools.html"><a href="unix-tools.html#web"><i class="fa fa-check"></i><b>8.7</b> Web</a>
<ul>
<li class="chapter" data-level="" data-path="unix-tools.html"><a href="unix-tools.html#assignment"><i class="fa fa-check"></i>Assignment</a></li>
</ul></li>
<li class="chapter" data-level="8.8" data-path="unix-tools.html"><a href="unix-tools.html#thm_w08"><i class="fa fa-check"></i><b>8.8</b> Take home message</a></li>
<li class="chapter" data-level="8.9" data-path="unix-tools.html"><a href="unix-tools.html#attributions_w08"><i class="fa fa-check"></i><b>8.9</b> Attributions</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="web-visualisation.html"><a href="web-visualisation.html"><i class="fa fa-check"></i><b>9</b> Web Visualisation</a>
<ul>
<li class="chapter" data-level="9.1" data-path="statistical-inference-and-causality.html"><a href="statistical-inference-and-causality.html#intro-w09"><i class="fa fa-check"></i><b>9.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="web-visualisation.html"><a href="web-visualisation.html#reading-list-w09"><i class="fa fa-check"></i><b>9.1.1</b> Reading list</a></li>
<li class="chapter" data-level="9.1.2" data-path="statistical-inference-and-causality.html"><a href="statistical-inference-and-causality.html#technical-help-session"><i class="fa fa-check"></i><b>9.1.2</b> Technical Help session</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="web-visualisation.html"><a href="web-visualisation.html#javascript"><i class="fa fa-check"></i><b>9.2</b> JavaScript</a>
<ul>
<li class="chapter" data-level="" data-path="unix-tools.html"><a href="unix-tools.html#assignment"><i class="fa fa-check"></i>Assignment</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="web-visualisation.html"><a href="web-visualisation.html#web-mapping"><i class="fa fa-check"></i><b>9.3</b> Web mapping</a></li>
<li class="chapter" data-level="9.4" data-path="web-visualisation.html"><a href="web-visualisation.html#leaflet.js"><i class="fa fa-check"></i><b>9.4</b> Leaflet.js</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="web-visualisation.html"><a href="web-visualisation.html#setting-up"><i class="fa fa-check"></i><b>9.4.1</b> Setting up</a></li>
<li class="chapter" data-level="9.4.2" data-path="web-visualisation.html"><a href="web-visualisation.html#simple-web-map"><i class="fa fa-check"></i><b>9.4.2</b> Simple web map</a></li>
<li class="chapter" data-level="9.4.3" data-path="web-visualisation.html"><a href="web-visualisation.html#choropleth-web-map"><i class="fa fa-check"></i><b>9.4.3</b> Choropleth web map</a></li>
<li class="chapter" data-level="" data-path="web-visualisation.html"><a href="web-visualisation.html#assignment-1"><i class="fa fa-check"></i>Assignment</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="web-visualisation.html"><a href="web-visualisation.html#web-visualisation-1"><i class="fa fa-check"></i><b>9.5</b> Web visualisation</a></li>
<li class="chapter" data-level="9.6" data-path="web-visualisation.html"><a href="web-visualisation.html#thm_w09"><i class="fa fa-check"></i><b>9.6</b> Take home message</a></li>
<li class="chapter" data-level="9.7" data-path="web-visualisation.html"><a href="web-visualisation.html#attributions_w09"><i class="fa fa-check"></i><b>9.7</b> Attributions</a></li>
</ul></li>
<li class="part"><span><b>Future</b></span></li>
<li class="chapter" data-level="10" data-path="a-look-into-the-future.html"><a href="a-look-into-the-future.html"><i class="fa fa-check"></i><b>10</b> A look into the future</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">GEOG0125: Advanced Topics in Social and Geographic Data Science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="web-visualisation" class="section level1" number="9">
<h1><span class="header-section-number">9</span> Web Visualisation</h1>
<div id="intro-w09" class="section level2" number="9.1">
<h2><span class="header-section-number">9.1</span> Introduction</h2>
<p>Web mapping or online mapping is the process of using the maps delivered by geographic information systems (GIS) on the Internet. With ever-increasing numbers of large demographic data sets becoming available, many provided as open data, web mapping platforms can be used to facilitate the use and exploration of these datasets. Examples of such web mapping platforms are <a href="https://datashine.org.uk/">DataShine</a>, <a href="https://maps.cdrc.ac.uk/">CDRC Maps</a>, and <a href="https://mapmaker.cdrc.ac.uk/">CDRC Mapmaker</a>.</p>
<p>This week we will dive a little deeper into creating web maps. We will do this by looking at “the leading open-source JavaScript library for mobile-friendly interactive maps”: <a href="https://leafletjs.com/">Leaflet.js</a>. Moreover, the lecture videos this week are provided by arguably the best mapmaker at UCL: <a href="https://oobrien.com/">Oliver O’Brien</a>. Oliver is a senior research associate at the UCL Department of Geography’s Geospatial Analytics and Computing group. He is interested in investigating and implementing new ways to visualise spatial and socioeconomic data, especially open datasets relating to transport, London and other urban areas. Oliver is also directly responsible for the creation of <a href="https://datashine.org.uk/">DataShine</a>, <a href="https://maps.cdrc.ac.uk/">CDRC Maps</a>, and the official maps for the <a href="https://simd.scot/#/simd2020/BTTTFTT/9/-4.0000/55.9000/">Scottish Index of Multiple Deprivation 2020</a>.</p>
<p>Let’s get mapping!</p>
<div id="video-introduction-w09" class="section level4 unnumbered">
<h4>Video: Introduction W09</h4>
<p><div class="vembedr" align="left">
<div>
<iframe src="https://web.microsoftstream.com/embed/video/d0273d51-09f6-41d0-a6eb-57f64b3462a1?autoplay=false&amp;showinfo=true" width="533" height="300" style="border:none;"></iframe>
</div>
</div>
[Lecture slides] <a href="https://web.microsoftstream.com/video/d0273d51-09f6-41d0-a6eb-57f64b3462a1">[Watch on MS stream]</a></p>
</div>
<div id="reading-list-w09" class="section level3" number="9.1.1">
<h3><span class="header-section-number">9.1.1</span> Reading list</h3>
<p>Because this week’s tutorial material is rather extensive and has a strong practical focus, we only have two articles as suggested reading this week.</p>
<div id="suggested-reading" class="section level4 unnumbered">
<h4>Suggested reading</h4>
<ul>
<li>O’Brien, O. and J. Cheshire. 2015. Interactive mapping for large, open demographic data sets using familiar geographical features. <em>Journal of Maps</em> 12(4): 676-683. <a href="https://doi.org/10.1080/17445647.2015.1060183">[Link]</a></li>
<li>Van Dijk, J. T. and P. A. Longley. 2020. Interactive display of surnames distributions in historic and contemporary Great Britain. <em>Journal of Maps</em> 16(1): 68-76. <a href="https://www.tandfonline.com/doi/full/10.1080/17445647.2020.1746418">[Link]</a></li>
</ul>
</div>
</div>
<div id="technical-help-session" class="section level3" number="9.1.2">
<h3><span class="header-section-number">9.1.2</span> Technical Help session</h3>
<p>Every Thursday between 13h00-14h00 you can join the <strong>Technical Help</strong> session on Microsoft Teams. The session will be hosted by <a href="https://www.ucl.ac.uk/geospatial-analytics/people/alfie-long">Alfie</a>. He will be there for the whole hour to answer any question you have live in the meeting or any questions you have formulated beforehand. If you cannot make the meeting, feel free to post the issue you are having in the Technical Help channel on the GEOG0125 Team so that Alfie can help to find a solution.</p>
</div>
</div>
<div id="javascript" class="section level2" number="9.2">
<h2><span class="header-section-number">9.2</span> JavaScript</h2>
<p>Alongside HTML and CSS, JavaScript (JS) is one of the core technologies of the World Wide Web. JavaScript enables interactive web pages and is an essential part of web applications. The vast majority of websites use it for <strong>client-side</strong> page behaviour and all major web browsers have a dedicated JavaScript engine to execute it. Basically you can say that:</p>
<ul>
<li>HTML is used to define the content of a web page;</li>
<li>CSS is used to specify the layout of a web page; and,</li>
<li>JS to define the behaviour of a web page.</li>
</ul>
<p>JavaScript is one of the most popular modern web technologies. However, getting comfortable with JavaScript is more challenging than getting comfortable with HTML and CSS. You may have to start small, and progress gradually.</p>
<div id="assignment" class="section level3 unnumbered">
<h3>Assignment</h3>
<p>This week we will be creating maps using <a href="leafletjs.com">Leaflet.js</a>. Leaflet.js is a JavaScript mapping library. This means that in order to create basic maps with Leaflet you will require a basic understanding of JavaScript. <a href="https://developer.mozilla.org/en-US/">MDN Web Doc</a> contains a very useful tutorial to get you started: <a href="https://developer.mozilla.org/en-US/docs/Learn/Getting_started_with_the_web/JavaScript_basics">JavaScript basics</a>. Before you continue with the rest of the tutorial, please work through this tutorial first.</p>
<div class="note">
<p><strong>Note</strong> <br/>
If you haven’t done so already, do install a text-editor to write your HTML/CSS/JS code in. Office document editors are not suitable for this use, as they rely on hidden elements that interfere with the rendering engines used by web browsers. <a href="https://atom.io/">Atom</a> is a good, free, open-source, cross-platform editor.</p>
</div>
</div>
</div>
<div id="web-mapping" class="section level2" number="9.3">
<h2><span class="header-section-number">9.3</span> Web mapping</h2>
<p>Although only a part of web visualisation, web maps are very important because they can convey a huge amount of data in a small space. Oliver will give an introduction to slippy maps, toolkits and platforms, and show several examples of web maps.</p>
<div id="video-web-mapping-basics" class="section level4 unnumbered">
<h4>Video: Web Mapping Basics</h4>
<p><div class="vembedr" align="left">
<div>
<iframe src="https://web.microsoftstream.com/embed/video/9b03713d-be6c-4074-88b1-31150582cbe7?autoplay=false&amp;showinfo=true" width="533" height="300" style="border:none;"></iframe>
</div>
</div>
<a href="https://github.com/jtvandijk/GEOG0125/blob/master/slides/w09/w09_01_web_vis.pdf">[Lecture slides]</a> <a href="https://web.microsoftstream.com/video/9b03713d-be6c-4074-88b1-31150582cbe7">[Watch on MS stream]</a></p>
<p>Now we have some background to creating maps online, we can start to create some maps ourselves using JavaScript mapping library Leaflet.js.</p>
</div>
</div>
<div id="leaflet.js" class="section level2" number="9.4">
<h2><span class="header-section-number">9.4</span> Leaflet.js</h2>
<p>As your web map will be embedded within a web page, we need to start with a basic HTML page in which we want to embed our map. You can download a prepared template here:</p>
<div id="file-download" class="section level4 unnumbered">
<h4>File download</h4>
<table>
<thead>
<tr class="header">
<th align="left">File</th>
<th align="left">Type</th>
<th align="left">Link</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Basic HTML file</td>
<td align="left"><code>html</code></td>
<td align="left"><a href="https://github.com/jtvandijk/GEOG0125/tree/master/raw/zip/index.zip">Download</a></td>
</tr>
</tbody>
</table>
<p>Once downloaded, you can open the <code>index.html</code> file using your text-editor. To see how the web page currently looks like, you can also open <code>index.html</code> in your browser (Figure <a href="web-visualisation.html#fig:basic-html">9.1</a>).</p>
<div class="figure" style="text-align: center"><span id="fig:basic-html"></span>
<img src="images/w09/basic-html.png" alt="Basic HTML file." width="762" />
<p class="caption">
Figure 9.1: Basic HTML file.
</p>
</div>
</div>
<div id="setting-up" class="section level3" number="9.4.1">
<h3><span class="header-section-number">9.4.1</span> Setting up</h3>
<p>Before writing any code for the map, you need to do the following preparation steps on your page:</p>
<ul>
<li>Include Leaflet CSS file in the head section of your document:</li>
</ul>
<div class="sourceCode" id="cb77"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb77-1"><a href="web-visualisation.html#cb77-1" aria-hidden="true"></a><span class="kw">&lt;link</span><span class="ot"> rel=</span><span class="st">&quot;stylesheet&quot;</span> </span>
<span id="cb77-2"><a href="web-visualisation.html#cb77-2" aria-hidden="true"></a><span class="ot">      href=</span><span class="st">&quot;https://unpkg.com/leaflet@1.7.1/dist/leaflet.css&quot;</span></span>
<span id="cb77-3"><a href="web-visualisation.html#cb77-3" aria-hidden="true"></a><span class="ot">      integrity=</span><span class="st">&quot;sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A==&quot;</span></span>
<span id="cb77-4"><a href="web-visualisation.html#cb77-4" aria-hidden="true"></a><span class="ot">      crossorigin=</span><span class="st">&quot;&quot;</span><span class="kw">/&gt;</span></span></code></pre></div>
<ul>
<li>Include Bootstrap CSS file:</li>
</ul>
<div class="sourceCode" id="cb78"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb78-1"><a href="web-visualisation.html#cb78-1" aria-hidden="true"></a><span class="kw">&lt;link</span><span class="ot"> rel=</span><span class="st">&quot;stylesheet&quot;</span> </span>
<span id="cb78-2"><a href="web-visualisation.html#cb78-2" aria-hidden="true"></a><span class="ot">      href=</span><span class="st">&quot;https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css&quot;</span></span>
<span id="cb78-3"><a href="web-visualisation.html#cb78-3" aria-hidden="true"></a><span class="ot">      integrity=</span><span class="st">&quot;sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T&quot;</span></span>
<span id="cb78-4"><a href="web-visualisation.html#cb78-4" aria-hidden="true"></a><span class="ot">      crossorigin=</span><span class="st">&quot;anonymous&quot;</span><span class="kw">/&gt;</span></span></code></pre></div>
<ul>
<li>Include Leaflet JavaScript file <strong>after</strong> Leaflet’s CSS:</li>
</ul>
<div class="sourceCode" id="cb79"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb79-1"><a href="web-visualisation.html#cb79-1" aria-hidden="true"></a><span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">&quot;https://unpkg.com/leaflet@1.7.1/dist/leaflet.js&quot;</span></span>
<span id="cb79-2"><a href="web-visualisation.html#cb79-2" aria-hidden="true"></a><span class="ot">        integrity=</span><span class="st">&quot;sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA==&quot;</span></span>
<span id="cb79-3"><a href="web-visualisation.html#cb79-3" aria-hidden="true"></a><span class="ot">        crossorigin=</span><span class="st">&quot;&quot;</span><span class="kw">&gt;</span></span>
<span id="cb79-4"><a href="web-visualisation.html#cb79-4" aria-hidden="true"></a><span class="kw">&lt;/script&gt;</span></span></code></pre></div>
<p>You may wonder why something called “Bootstrap” is included here. Well, technically this is not necessary. However, <a href="https://getbootstrap.com/">Bootstrap</a> is a free front-end framework for faster and easier web development. Bootstrap includes HTML and CSS based design templates for typography, forms, buttons, tables, navigation, modals, image carousels and many other, as well as optional JavaScript plugins. Bootstrap also gives you the ability to easily create responsive designs. What this means is that you can use pre-created CSS classes and apply it directly to your HTML. For instance, the <code>container mb-3</code> class you may have spotted in in your <code>index.html</code> is actually a CSS class that is found in the Bootstrap CSS. Notice the difference between Figure <a href="web-visualisation.html#fig:basic-html">9.1</a> and Figure <a href="web-visualisation.html#fig:add-css">9.2</a>?</p>
<div class="figure" style="text-align: center"><span id="fig:add-css"></span>
<img src="images/w09/add-css.png" alt="Basic HTML file with Bootstrap CSS." width="784" />
<p class="caption">
Figure 9.2: Basic HTML file with Bootstrap CSS.
</p>
</div>
<p>Now we can put a <code>div</code> element with a certain <strong>id</strong> on the place where you want the map to be. Replace the <code>&lt;!--map will be here--&gt;</code> in your <code>index.html</code> document with the following code:</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb80-1"><a href="web-visualisation.html#cb80-1" aria-hidden="true"></a><span class="kw">&lt;div</span><span class="ot"> id=</span><span class="st">&quot;simple_map&quot;</span><span class="ot"> class=</span><span class="st">&quot;card-body p-0&quot;</span><span class="kw">&gt;</span></span>
<span id="cb80-2"><a href="web-visualisation.html#cb80-2" aria-hidden="true"></a>  <span class="kw">&lt;canvas</span><span class="ot"> width=</span><span class="st">&quot;100&quot;</span><span class="ot"> height=</span><span class="st">&quot;850&quot;</span><span class="kw">&gt;&lt;/canvas&gt;</span></span>
<span id="cb80-3"><a href="web-visualisation.html#cb80-3" aria-hidden="true"></a><span class="kw">&lt;/div&gt;</span></span></code></pre></div>
<p>It is important that the element that will be containing the map, has a specified height. We do this by giving the <code>canvas</code> element a <code>width</code> of <code>100</code> and a <code>height</code> of <code>850</code>. You can see the effect of this change immediately (Figure <a href="web-visualisation.html#fig:add-canvas">9.3</a>).</p>
<div class="figure" style="text-align: center"><span id="fig:add-canvas"></span>
<img src="images/w09/add-canvas.png" alt="Basic HTML file with map canvas." width="784" />
<p class="caption">
Figure 9.3: Basic HTML file with map canvas.
</p>
</div>
<p>The next thing we need to do is create a separate JavaScript file: <code>map.js</code>. This is the file were the Leaflet code will live. Save the file in the same folder as your <code>index.html</code> page. We also include a link to the file in our <code>index.html</code> file. Add the following directly below the <code>&lt;canvas id="simple_map" width="100" height="850"&gt;&lt;/canvas&gt;</code> element:</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb81-1"><a href="web-visualisation.html#cb81-1" aria-hidden="true"></a><span class="co">&lt;!--map js--&gt;</span></span>
<span id="cb81-2"><a href="web-visualisation.html#cb81-2" aria-hidden="true"></a><span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">&quot;map.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span></span></code></pre></div>
</div>
<div id="simple-web-map" class="section level3" number="9.4.2">
<h3><span class="header-section-number">9.4.2</span> Simple web map</h3>
<p>Now we are fully set up, we can start by creating a map of the center of London with some Carto map tiles. First we will initialise the map and set its view to our chosen geographical coordinates and a zoom level:</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb82-1"><a href="web-visualisation.html#cb82-1" aria-hidden="true"></a><span class="co">// set up map in the map.js file</span></span>
<span id="cb82-2"><a href="web-visualisation.html#cb82-2" aria-hidden="true"></a><span class="kw">var</span> smap <span class="op">=</span> L<span class="op">.</span><span class="fu">map</span>(<span class="st">&#39;simple_map&#39;</span>)<span class="op">.</span><span class="fu">setView</span>([<span class="fl">51.505</span><span class="op">,</span> <span class="fl">-0.09</span>]<span class="op">,</span> <span class="dv">12</span>)<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// set up map in the map.js file
var smap = L.map('simple_map').setView([51.505, -0.09], 12);
</script>
<p>Note that the <code>id</code> that we gave to the <code>canvas</code> HTML element is used here to initiate the map. Next we’ll add a tile layer to add to our map, in this case it’s a Carto tile layer. Creating a tile layer usually involves setting the URL template for the tile images, the attribution text and the maximum zoom level of the layer. Make sure all the code is called <strong>after</strong> the <code>canvas</code> and Leaflet.js inclusion in your HTML page; e.g. you cannot refer to <code>map.js</code> <strong>before</strong> you have included your <code>canvas</code> HTML element and <strong>before</strong> you have included the Leaflet JavaScript file.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb83-1"><a href="web-visualisation.html#cb83-1" aria-hidden="true"></a><span class="co">// create tile layer, add to map</span></span>
<span id="cb83-2"><a href="web-visualisation.html#cb83-2" aria-hidden="true"></a>L<span class="op">.</span><span class="fu">tileLayer</span>(<span class="st">&#39;https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png&#39;</span><span class="op">,</span> </span>
<span id="cb83-3"><a href="web-visualisation.html#cb83-3" aria-hidden="true"></a>    {<span class="dt">attribution</span><span class="op">:</span> <span class="st">&#39;Map tiles by Carto, under CC BY 3.0. Data by OpenStreetMap, under ODbL&#39;</span><span class="op">,</span></span>
<span id="cb83-4"><a href="web-visualisation.html#cb83-4" aria-hidden="true"></a>    <span class="dt">maxZoom</span><span class="op">:</span> <span class="dv">18</span><span class="op">,</span></span>
<span id="cb83-5"><a href="web-visualisation.html#cb83-5" aria-hidden="true"></a>})<span class="op">.</span><span class="fu">addTo</span>(smap)<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// create tile layer, add to map
L.tileLayer('https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png', 
    {attribution: 'Map tiles by Carto, under CC BY 3.0. Data by OpenStreetMap, under ODbL',
    maxZoom: 18,
}).addTo(smap);
</script>
<p>That is it. Your basic map layer is now working: you can confirm this by opening your <code>index.html</code> file in your browser (Figure <a href="web-visualisation.html#fig:basic-map">9.4</a>).</p>
<div class="figure" style="text-align: center"><span id="fig:basic-map"></span>
<img src="images/w09/basic-map.png" alt="Basic map." width="784" />
<p class="caption">
Figure 9.4: Basic map.
</p>
</div>
<div class="note">
<p><strong>Note</strong><br />
If your map does not show it means that something did go wrong, perhaps the map did not properly load or perhaps your <code>map.js</code> file is not in the same location as the <code>index.html</code> file. You can check for errors in the browser by using your browser’s developer’s tools. If using Google Chrome, you can <a href="https://developers.google.com/web/tools/chrome-devtools/open">right click in your browser window</a> and click on <em>inspect</em> to open <em>Chrome DevTools</em>. The <em>console</em> tab brings you to the JavaScript console and will show messages that can help you debug.</p>
</div>
<p>Besides tile layers, you can easily add other things to your map, including markers, polylines, polygons, circles, and popups. Let’s add a marker:</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb84-1"><a href="web-visualisation.html#cb84-1" aria-hidden="true"></a><span class="co">// create marker</span></span>
<span id="cb84-2"><a href="web-visualisation.html#cb84-2" aria-hidden="true"></a><span class="kw">var</span> marker <span class="op">=</span> L<span class="op">.</span><span class="fu">marker</span>([<span class="fl">51.5</span><span class="op">,</span> <span class="fl">-0.09</span>])<span class="op">;</span></span>
<span id="cb84-3"><a href="web-visualisation.html#cb84-3" aria-hidden="true"></a></span>
<span id="cb84-4"><a href="web-visualisation.html#cb84-4" aria-hidden="true"></a><span class="co">// add to map</span></span>
<span id="cb84-5"><a href="web-visualisation.html#cb84-5" aria-hidden="true"></a>marker<span class="op">.</span><span class="fu">addTo</span>(smap)<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// create marker
var marker = L.marker([51.5, -0.09]);

// add to map
marker.addTo(smap);
</script>
<p>Adding a circle is the same (except for specifying the radius in meters as a second argument), but lets you control how it looks by passing options as the last argument when creating the object:</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb85-1"><a href="web-visualisation.html#cb85-1" aria-hidden="true"></a><span class="co">// create circle</span></span>
<span id="cb85-2"><a href="web-visualisation.html#cb85-2" aria-hidden="true"></a><span class="kw">var</span> circle <span class="op">=</span> L<span class="op">.</span><span class="fu">circle</span>([<span class="fl">51.508</span><span class="op">,</span> <span class="fl">-0.11</span>]<span class="op">,</span> {</span>
<span id="cb85-3"><a href="web-visualisation.html#cb85-3" aria-hidden="true"></a>    <span class="dt">color</span><span class="op">:</span> <span class="st">&#39;red&#39;</span><span class="op">,</span></span>
<span id="cb85-4"><a href="web-visualisation.html#cb85-4" aria-hidden="true"></a>    <span class="dt">fillColor</span><span class="op">:</span> <span class="st">&#39;#f03&#39;</span><span class="op">,</span></span>
<span id="cb85-5"><a href="web-visualisation.html#cb85-5" aria-hidden="true"></a>    <span class="dt">fillOpacity</span><span class="op">:</span> <span class="fl">0.5</span><span class="op">,</span></span>
<span id="cb85-6"><a href="web-visualisation.html#cb85-6" aria-hidden="true"></a>    <span class="dt">radius</span><span class="op">:</span> <span class="dv">500</span></span>
<span id="cb85-7"><a href="web-visualisation.html#cb85-7" aria-hidden="true"></a>})<span class="op">;</span></span>
<span id="cb85-8"><a href="web-visualisation.html#cb85-8" aria-hidden="true"></a></span>
<span id="cb85-9"><a href="web-visualisation.html#cb85-9" aria-hidden="true"></a><span class="co">// add to map</span></span>
<span id="cb85-10"><a href="web-visualisation.html#cb85-10" aria-hidden="true"></a>circle<span class="op">.</span><span class="fu">addTo</span>(smap)<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// create circle
var circle = L.circle([51.508, -0.11], {
    color: 'red',
    fillColor: '#f03',
    fillOpacity: 0.5,
    radius: 500
});

// add to map
circle.addTo(smap);
</script>
<p>Adding a polygon is as easy:</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb86-1"><a href="web-visualisation.html#cb86-1" aria-hidden="true"></a><span class="co">// create polygon</span></span>
<span id="cb86-2"><a href="web-visualisation.html#cb86-2" aria-hidden="true"></a><span class="kw">var</span> polygon <span class="op">=</span> L<span class="op">.</span><span class="fu">polygon</span>([</span>
<span id="cb86-3"><a href="web-visualisation.html#cb86-3" aria-hidden="true"></a>    [<span class="fl">51.509</span><span class="op">,</span> <span class="fl">-0.08</span>]<span class="op">,</span></span>
<span id="cb86-4"><a href="web-visualisation.html#cb86-4" aria-hidden="true"></a>    [<span class="fl">51.503</span><span class="op">,</span> <span class="fl">-0.06</span>]<span class="op">,</span></span>
<span id="cb86-5"><a href="web-visualisation.html#cb86-5" aria-hidden="true"></a>    [<span class="fl">51.51</span><span class="op">,</span> <span class="fl">-0.047</span>]</span>
<span id="cb86-6"><a href="web-visualisation.html#cb86-6" aria-hidden="true"></a>])<span class="op">;</span></span>
<span id="cb86-7"><a href="web-visualisation.html#cb86-7" aria-hidden="true"></a></span>
<span id="cb86-8"><a href="web-visualisation.html#cb86-8" aria-hidden="true"></a><span class="co">// add to map</span></span>
<span id="cb86-9"><a href="web-visualisation.html#cb86-9" aria-hidden="true"></a>polygon<span class="op">.</span><span class="fu">addTo</span>(smap)<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// create polygon
var polygon = L.polygon([
    [51.509, -0.08],
    [51.503, -0.06],
    [51.51, -0.047]
]);

// add to map
polygon.addTo(smap);
</script>
<p>The result is a simple map that includes a marker, circle, and simple polygon. If you open <code>index.html</code> in your browser again, your screen now resemble Figure <a href="web-visualisation.html#fig:basic-map-marker">9.5</a>.</p>
<div class="figure" style="text-align: center"><span id="fig:basic-map-marker"></span>
<img src="images/w09/basic-map-marker.png" alt="Basic map with a marker, a circle, and a polygon." width="784" />
<p class="caption">
Figure 9.5: Basic map with a marker, a circle, and a polygon.
</p>
</div>
<p>To finalise this simple map, we can also add some popups to our map objects.</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb87-1"><a href="web-visualisation.html#cb87-1" aria-hidden="true"></a><span class="co">// add popups</span></span>
<span id="cb87-2"><a href="web-visualisation.html#cb87-2" aria-hidden="true"></a>marker<span class="op">.</span><span class="fu">bindPopup</span>(<span class="st">&quot;&lt;b&gt;Hello world!&lt;/b&gt;&lt;br&gt;I am a marker.&quot;</span>)<span class="op">.</span><span class="fu">openPopup</span>()<span class="op">;</span></span>
<span id="cb87-3"><a href="web-visualisation.html#cb87-3" aria-hidden="true"></a>circle<span class="op">.</span><span class="fu">bindPopup</span>(<span class="st">&quot;I am a circle.&quot;</span>)<span class="op">;</span></span>
<span id="cb87-4"><a href="web-visualisation.html#cb87-4" aria-hidden="true"></a>polygon<span class="op">.</span><span class="fu">bindPopup</span>(<span class="st">&quot;I am a polygon.&quot;</span>)<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// add popups
marker.bindPopup("<b>Hello world!</b><br>I am a marker.").openPopup();
circle.bindPopup("I am a circle.");
polygon.bindPopup("I am a polygon.");
</script>
<p>Try clicking on the objects. The <code>bindPopup</code> method attaches a popup with the specified HTML content to your marker so the popup appears when you click on the object, and the <code>openPopup</code> method (for markers only) immediately opens the attached popup.</p>
</div>
<div id="choropleth-web-map" class="section level3" number="9.4.3">
<h3><span class="header-section-number">9.4.3</span> Choropleth web map</h3>
<p>Now, let’s move to something a little more advanced and try to create a choropleth web map of 2021 projected <a href="https://data.london.gov.uk/dataset/land-area-and-population-density-ward-and-borough">population density in London’s boroughs</a>. Start by creating a new basic HTML file (<code>index_choropleth.html</code>) as well as a new, empty JS file (<code>choropleth.js</code>). Because the amount of data (borough shapes and the density value for each borough) is not very big, the most convenient and simple way to store and then display it is by using <code>GeoJSON</code>. We have created this <code>GeoJSON</code> file for you and you can download it below. Save the file in the same folder as your new basic HTML file and your new, empty JS file.</p>
<div id="file-download-1" class="section level4 unnumbered">
<h4>File download</h4>
<table>
<thead>
<tr class="header">
<th align="left">File</th>
<th align="left">Type</th>
<th align="left">Link</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">London Population Density</td>
<td align="left"><code>geojson</code></td>
<td align="left"><a href="https://github.com/jtvandijk/GEOG0125/tree/master/raw/zip/london.zip">Download</a></td>
</tr>
</tbody>
</table>
<p>The features of the <code>GeoJSON</code> data (<em>london.geojson</em>) will look like this:</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb88-1"><a href="web-visualisation.html#cb88-1" aria-hidden="true"></a>{</span>
<span id="cb88-2"><a href="web-visualisation.html#cb88-2" aria-hidden="true"></a><span class="st">&quot;type&quot;</span><span class="op">:</span> <span class="st">&quot;FeatureCollection&quot;</span><span class="op">,</span></span>
<span id="cb88-3"><a href="web-visualisation.html#cb88-3" aria-hidden="true"></a><span class="st">&quot;name&quot;</span><span class="op">:</span> <span class="st">&quot;london&quot;</span><span class="op">,</span></span>
<span id="cb88-4"><a href="web-visualisation.html#cb88-4" aria-hidden="true"></a> <span class="st">&quot;crs&quot;</span><span class="op">:</span> { <span class="st">&quot;type&quot;</span><span class="op">:</span> <span class="st">&quot;name&quot;</span><span class="op">,</span> <span class="st">&quot;properties&quot;</span><span class="op">:</span> { <span class="st">&quot;name&quot;</span><span class="op">:</span> <span class="st">&quot;urn:ogc:def:crs:EPSG::27700&quot;</span> } }<span class="op">,</span></span>
<span id="cb88-5"><a href="web-visualisation.html#cb88-5" aria-hidden="true"></a>  <span class="st">&quot;features&quot;</span><span class="op">:</span> [</span>
<span id="cb88-6"><a href="web-visualisation.html#cb88-6" aria-hidden="true"></a>      { <span class="st">&quot;type&quot;</span><span class="op">:</span> <span class="st">&quot;Feature&quot;</span><span class="op">,</span> <span class="st">&quot;properties&quot;</span><span class="op">:</span> </span>
<span id="cb88-7"><a href="web-visualisation.html#cb88-7" aria-hidden="true"></a>        { <span class="st">&quot;NAME&quot;</span><span class="op">:</span> <span class="st">&quot;Kingston upon Thames&quot;</span><span class="op">,</span> <span class="st">&quot;GSS_CODE&quot;</span><span class="op">:</span> <span class="st">&quot;E09000021&quot;</span><span class="op">,</span> <span class="st">&quot;POPDENS&quot;</span><span class="op">:</span> <span class="dv">4955</span> }<span class="op">,</span> </span>
<span id="cb88-8"><a href="web-visualisation.html#cb88-8" aria-hidden="true"></a>        <span class="st">&quot;geometry&quot;</span><span class="op">:</span> <span class="op">...</span> </span></code></pre></div>
<script type="text/javascript">
{
"type": "FeatureCollection",
"name": "london",
 "crs": { "type": "name", "properties": { "name": "urn:ogc:def:crs:EPSG::27700" } },
  "features": [
      { "type": "Feature", "properties": 
        { "NAME": "Kingston upon Thames", "GSS_CODE": "E09000021", "POPDENS": 4955 }, 
        "geometry": ... 
</script>
<p>As we want JavaScript to treat this simple <code>GeoJSON</code> file as a variable, we have to make a small change to the file. Open the file in your text editor and add <code>var boroughs =</code> to the beginning of the file:</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb89-1"><a href="web-visualisation.html#cb89-1" aria-hidden="true"></a><span class="kw">var</span> boroughs <span class="op">=</span> {</span>
<span id="cb89-2"><a href="web-visualisation.html#cb89-2" aria-hidden="true"></a><span class="st">&quot;type&quot;</span><span class="op">:</span> <span class="st">&quot;FeatureCollection&quot;</span><span class="op">,</span></span>
<span id="cb89-3"><a href="web-visualisation.html#cb89-3" aria-hidden="true"></a><span class="st">&quot;name&quot;</span><span class="op">:</span> <span class="st">&quot;london&quot;</span><span class="op">,</span></span>
<span id="cb89-4"><a href="web-visualisation.html#cb89-4" aria-hidden="true"></a> <span class="st">&quot;crs&quot;</span><span class="op">:</span> { <span class="st">&quot;type&quot;</span><span class="op">:</span> <span class="st">&quot;name&quot;</span><span class="op">,</span> <span class="st">&quot;properties&quot;</span><span class="op">:</span> { <span class="st">&quot;name&quot;</span><span class="op">:</span> <span class="st">&quot;urn:ogc:def:crs:EPSG::27700&quot;</span> } }<span class="op">,</span></span>
<span id="cb89-5"><a href="web-visualisation.html#cb89-5" aria-hidden="true"></a>  <span class="st">&quot;features&quot;</span><span class="op">:</span> [</span>
<span id="cb89-6"><a href="web-visualisation.html#cb89-6" aria-hidden="true"></a>      { <span class="st">&quot;type&quot;</span><span class="op">:</span> <span class="st">&quot;Feature&quot;</span><span class="op">,</span> <span class="st">&quot;properties&quot;</span><span class="op">:</span> </span>
<span id="cb89-7"><a href="web-visualisation.html#cb89-7" aria-hidden="true"></a>        { <span class="st">&quot;NAME&quot;</span><span class="op">:</span> <span class="st">&quot;Kingston upon Thames&quot;</span><span class="op">,</span> <span class="st">&quot;GSS_CODE&quot;</span><span class="op">:</span> <span class="st">&quot;E09000021&quot;</span><span class="op">,</span> <span class="st">&quot;POPDENS&quot;</span><span class="op">:</span> <span class="dv">4955</span> }<span class="op">,</span> </span>
<span id="cb89-8"><a href="web-visualisation.html#cb89-8" aria-hidden="true"></a>        <span class="st">&quot;geometry&quot;</span><span class="op">:</span> <span class="op">...</span> </span></code></pre></div>
<script type="text/javascript">
var boroughs = {
"type": "FeatureCollection",
"name": "london",
 "crs": { "type": "name", "properties": { "name": "urn:ogc:def:crs:EPSG::27700" } },
  "features": [
      { "type": "Feature", "properties": 
        { "NAME": "Kingston upon Thames", "GSS_CODE": "E09000021", "POPDENS": 4955 }, 
        "geometry": ... 
</script>
<p>Now we can set up our HTML file to include <strong>both</strong> the <code>GeoJSON</code> file as well as the our new JavaScript file. Depending on how you named your files, this means that you need to add something like this to your HTML file:</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb90-1"><a href="web-visualisation.html#cb90-1" aria-hidden="true"></a><span class="co">&lt;!--map js--&gt;</span></span>
<span id="cb90-2"><a href="web-visualisation.html#cb90-2" aria-hidden="true"></a><span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">&quot;london.geojson&quot;</span><span class="kw">&gt;&lt;/script&gt;</span></span>
<span id="cb90-3"><a href="web-visualisation.html#cb90-3" aria-hidden="true"></a><span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">&quot;choropleth.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span></span></code></pre></div>
<div class="note">
<p><strong>Note</strong> <br/>
Make sure that the order of the scripts is correct: the <code>GeoJSON</code> file will need to be put <strong>above</strong> the JavaScript file that will contain our map code. Also make sure that you have added a <code>div</code> with an <strong>id</strong> to which we can link our JavaScript code.</p>
</div>
<p>The next step is to initiate the map in our <code>choropleth.js</code> file:</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb91-1"><a href="web-visualisation.html#cb91-1" aria-hidden="true"></a><span class="co">// set up map in the choropleth.js file</span></span>
<span id="cb91-2"><a href="web-visualisation.html#cb91-2" aria-hidden="true"></a><span class="kw">var</span> cmap <span class="op">=</span> L<span class="op">.</span><span class="fu">map</span>(<span class="st">&#39;choropleth&#39;</span>)<span class="op">.</span><span class="fu">setView</span>([<span class="fl">51.505</span><span class="op">,</span> <span class="fl">-0.09</span>]<span class="op">,</span> <span class="dv">8</span>)<span class="op">;</span></span>
<span id="cb91-3"><a href="web-visualisation.html#cb91-3" aria-hidden="true"></a></span>
<span id="cb91-4"><a href="web-visualisation.html#cb91-4" aria-hidden="true"></a><span class="co">// create tile layer, add to map</span></span>
<span id="cb91-5"><a href="web-visualisation.html#cb91-5" aria-hidden="true"></a>L<span class="op">.</span><span class="fu">tileLayer</span>(<span class="st">&#39;https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png&#39;</span><span class="op">,</span></span>
<span id="cb91-6"><a href="web-visualisation.html#cb91-6" aria-hidden="true"></a>    {<span class="dt">attribution</span><span class="op">:</span> <span class="st">&#39;Map tiles by Carto, under CC BY 3.0. Data by OpenStreetMap, under ODbL&#39;</span><span class="op">,</span></span>
<span id="cb91-7"><a href="web-visualisation.html#cb91-7" aria-hidden="true"></a>     <span class="dt">maxZoom</span><span class="op">:</span> <span class="dv">18</span><span class="op">,</span></span>
<span id="cb91-8"><a href="web-visualisation.html#cb91-8" aria-hidden="true"></a>})<span class="op">.</span><span class="fu">addTo</span>(cmap)<span class="op">;</span></span>
<span id="cb91-9"><a href="web-visualisation.html#cb91-9" aria-hidden="true"></a></span>
<span id="cb91-10"><a href="web-visualisation.html#cb91-10" aria-hidden="true"></a><span class="co">// add London boroughs</span></span>
<span id="cb91-11"><a href="web-visualisation.html#cb91-11" aria-hidden="true"></a>L<span class="op">.</span><span class="fu">geoJson</span>(boroughs)<span class="op">.</span><span class="fu">addTo</span>(cmap)<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// set up map in the choropleth.js file
var cmap = L.map('choropleth').setView([51.505, -0.09], 8);

// create tile layer, add to map
L.tileLayer('https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png',
    {attribution: 'Map tiles by Carto, under CC BY 3.0. Data by OpenStreetMap, under ODbL',
     maxZoom: 18,
}).addTo(cmap);

// add London boroughs
L.geoJson(boroughs).addTo(cmap);
</script>
<p>If your setup is correct, the London boroughs should now show as in Figure <a href="web-visualisation.html#fig:london-boroughs">9.6</a>.</p>
<div class="figure" style="text-align: center"><span id="fig:london-boroughs"></span>
<img src="images/w09/london-boroughs.png" alt="London boroughs with GeoJSON." width="784" />
<p class="caption">
Figure 9.6: London boroughs with GeoJSON.
</p>
</div>
<div class="note">
<p><strong>Note</strong> <br/>
When you prepare your own map layers with this method you need to pay attention to at least <strong>two</strong> things. First, your map layers cannot be too large and as such in some cases you may want to simplify your polygons. Large shapefiles with lots of details will require a different approach, e.g. through creating a slippy map. Second, Leaflet’s default projection is <code>EPSG:3857</code>, also known as “Google Mercator” or “Web Mercator”. In order for your map layers to show correctly you will need to make sure your <code>GeoJSON</code> is projected in <code>EPSG:4326</code> (WGS 84). If this is not the case, you can re-project your data using, for instance, <a href="https://docs.qgis.org/2.8/en/docs/training_manual/vector_analysis/reproject_transform.html">Q-GIS</a> or <a href="https://r-spatial.github.io/sf/reference/st_transform.html">R</a>.</p>
</div>
<p>Now we need to colour the boroughs according to their population density. You can use <a href="https://colorbrewer2.org/#type=sequential&amp;scheme=OrRd&amp;n=5">colorbrewer 2.0</a> to select colours. Once we selected some nice colours, we can create a function that returns a colour based on population density:</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb92-1"><a href="web-visualisation.html#cb92-1" aria-hidden="true"></a><span class="co">// colour function</span></span>
<span id="cb92-2"><a href="web-visualisation.html#cb92-2" aria-hidden="true"></a><span class="kw">function</span> <span class="fu">getColour</span>(d) {</span>
<span id="cb92-3"><a href="web-visualisation.html#cb92-3" aria-hidden="true"></a>    <span class="cf">return</span> d <span class="op">&gt;</span> <span class="dv">20000</span> <span class="op">?</span> <span class="st">&#39;#b30000&#39;</span> <span class="op">:</span></span>
<span id="cb92-4"><a href="web-visualisation.html#cb92-4" aria-hidden="true"></a>           d <span class="op">&gt;</span> <span class="dv">15000</span> <span class="op">?</span> <span class="st">&#39;#e34a33&#39;</span> <span class="op">:</span></span>
<span id="cb92-5"><a href="web-visualisation.html#cb92-5" aria-hidden="true"></a>           d <span class="op">&gt;</span> <span class="dv">10000</span> <span class="op">?</span> <span class="st">&#39;#fc8d59&#39;</span> <span class="op">:</span></span>
<span id="cb92-6"><a href="web-visualisation.html#cb92-6" aria-hidden="true"></a>           d <span class="op">&gt;</span> <span class="dv">5000</span>  <span class="op">?</span> <span class="st">&#39;#fdcc8a&#39;</span> <span class="op">:</span></span>
<span id="cb92-7"><a href="web-visualisation.html#cb92-7" aria-hidden="true"></a>                       <span class="st">&#39;#fef0d9&#39;</span> <span class="op">;</span></span>
<span id="cb92-8"><a href="web-visualisation.html#cb92-8" aria-hidden="true"></a>}<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// colour function
function getColour(d) {
    return d > 20000 ? '#b30000' :
           d > 15000 ? '#e34a33' :
           d > 10000 ? '#fc8d59' :
           d > 5000  ? '#fdcc8a' :
                       '#fef0d9' ;
};
</script>
<p>Next we define a styling function for our <code>GeoJSON</code> layer so that its <code>fillColor</code> depends on <code>feature.properties.POPDENS</code> property, also adjusting the appearance a bit and adding a nice touch with dashed stroke.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb93-1"><a href="web-visualisation.html#cb93-1" aria-hidden="true"></a><span class="co">// style function</span></span>
<span id="cb93-2"><a href="web-visualisation.html#cb93-2" aria-hidden="true"></a><span class="kw">function</span> <span class="fu">style</span>(feature) {</span>
<span id="cb93-3"><a href="web-visualisation.html#cb93-3" aria-hidden="true"></a>    <span class="cf">return</span> {</span>
<span id="cb93-4"><a href="web-visualisation.html#cb93-4" aria-hidden="true"></a>        <span class="dt">fillColor</span><span class="op">:</span> <span class="fu">getColour</span>(feature<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">POPDENS</span>)<span class="op">,</span></span>
<span id="cb93-5"><a href="web-visualisation.html#cb93-5" aria-hidden="true"></a>        <span class="dt">weight</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb93-6"><a href="web-visualisation.html#cb93-6" aria-hidden="true"></a>        <span class="dt">opacity</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb93-7"><a href="web-visualisation.html#cb93-7" aria-hidden="true"></a>        <span class="dt">color</span><span class="op">:</span> <span class="st">&#39;white&#39;</span><span class="op">,</span></span>
<span id="cb93-8"><a href="web-visualisation.html#cb93-8" aria-hidden="true"></a>        <span class="dt">dashArray</span><span class="op">:</span> <span class="st">&#39;3&#39;</span><span class="op">,</span></span>
<span id="cb93-9"><a href="web-visualisation.html#cb93-9" aria-hidden="true"></a>        <span class="dt">fillOpacity</span><span class="op">:</span> <span class="fl">0.7</span></span>
<span id="cb93-10"><a href="web-visualisation.html#cb93-10" aria-hidden="true"></a>    }<span class="op">;</span></span>
<span id="cb93-11"><a href="web-visualisation.html#cb93-11" aria-hidden="true"></a>}<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// style function
function style(feature) {
    return {
        fillColor: getColour(feature.properties.POPDENS),
        weight: 2,
        opacity: 1,
        color: 'white',
        dashArray: '3',
        fillOpacity: 0.7
    };
};
</script>
<p>Make sure that both the <code>getColour()</code> function and the <code>style()</code> function are included in <code>choropleth.js</code> <strong>before</strong> you add London boroughs to the map with:</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb94-1"><a href="web-visualisation.html#cb94-1" aria-hidden="true"></a><span class="co">// add London boroughs</span></span>
<span id="cb94-2"><a href="web-visualisation.html#cb94-2" aria-hidden="true"></a>L<span class="op">.</span><span class="fu">geoJson</span>(boroughs<span class="op">,</span>{<span class="dt">style</span><span class="op">:</span> style})<span class="op">.</span><span class="fu">addTo</span>(cmap)<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// add London boroughs
L.geoJson(boroughs,{style: style}).addTo(cmap);
</script>
<p>And there we go:</p>
<div class="figure" style="text-align: center"><span id="fig:london-boroughs-colour"></span>
<img src="images/w09/london-boroughs-colour.png" alt="London borough population density choropleth." width="784" />
<p class="caption">
Figure 9.7: London borough population density choropleth.
</p>
</div>
<p>We can make things a little more interesting by adding some interaction by highlighting boroughs when they are hovered with a mouse. First, we’ll need an <a href="https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Building_blocks/Events">event listener</a> for a layer mouseover event:</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb95-1"><a href="web-visualisation.html#cb95-1" aria-hidden="true"></a><span class="co">// event listener</span></span>
<span id="cb95-2"><a href="web-visualisation.html#cb95-2" aria-hidden="true"></a><span class="kw">function</span> <span class="fu">highlightFeature</span>(e) {</span>
<span id="cb95-3"><a href="web-visualisation.html#cb95-3" aria-hidden="true"></a>    <span class="kw">var</span> layer <span class="op">=</span> e<span class="op">.</span><span class="at">target</span><span class="op">;</span></span>
<span id="cb95-4"><a href="web-visualisation.html#cb95-4" aria-hidden="true"></a></span>
<span id="cb95-5"><a href="web-visualisation.html#cb95-5" aria-hidden="true"></a>    layer<span class="op">.</span><span class="fu">setStyle</span>({</span>
<span id="cb95-6"><a href="web-visualisation.html#cb95-6" aria-hidden="true"></a>        <span class="dt">weight</span><span class="op">:</span> <span class="dv">5</span><span class="op">,</span></span>
<span id="cb95-7"><a href="web-visualisation.html#cb95-7" aria-hidden="true"></a>        <span class="dt">color</span><span class="op">:</span> <span class="st">&#39;#666&#39;</span><span class="op">,</span></span>
<span id="cb95-8"><a href="web-visualisation.html#cb95-8" aria-hidden="true"></a>        <span class="dt">dashArray</span><span class="op">:</span> <span class="st">&#39;&#39;</span><span class="op">,</span></span>
<span id="cb95-9"><a href="web-visualisation.html#cb95-9" aria-hidden="true"></a>        <span class="dt">fillOpacity</span><span class="op">:</span> <span class="fl">0.7</span></span>
<span id="cb95-10"><a href="web-visualisation.html#cb95-10" aria-hidden="true"></a>    })<span class="op">;</span></span>
<span id="cb95-11"><a href="web-visualisation.html#cb95-11" aria-hidden="true"></a>    </span>
<span id="cb95-12"><a href="web-visualisation.html#cb95-12" aria-hidden="true"></a>    <span class="cf">if</span> (<span class="op">!</span>L<span class="op">.</span><span class="at">Browser</span><span class="op">.</span><span class="at">ie</span> <span class="op">&amp;&amp;</span> <span class="op">!</span>L<span class="op">.</span><span class="at">Browser</span><span class="op">.</span><span class="at">opera</span> <span class="op">&amp;&amp;</span> <span class="op">!</span>L<span class="op">.</span><span class="at">Browser</span><span class="op">.</span><span class="at">edge</span>) {</span>
<span id="cb95-13"><a href="web-visualisation.html#cb95-13" aria-hidden="true"></a>        layer<span class="op">.</span><span class="fu">bringToFront</span>()<span class="op">;</span></span>
<span id="cb95-14"><a href="web-visualisation.html#cb95-14" aria-hidden="true"></a>    }</span>
<span id="cb95-15"><a href="web-visualisation.html#cb95-15" aria-hidden="true"></a>}<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// event listener
function highlightFeature(e) {
    var layer = e.target;

    layer.setStyle({
        weight: 5,
        color: '#666',
        dashArray: '',
        fillOpacity: 0.7
    });
    
    if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
        layer.bringToFront();
    }
};
</script>
<p>Here we get access to the layer that was hovered through <code>e.target</code>, set a thick grey border on the layer as our highlight effect, also bringing it to the front so that the border does not clash with nearby states. Next we’ll define what happens once the mouse is not hovering over the layer anymore:</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb96-1"><a href="web-visualisation.html#cb96-1" aria-hidden="true"></a><span class="co">// reset layout</span></span>
<span id="cb96-2"><a href="web-visualisation.html#cb96-2" aria-hidden="true"></a><span class="kw">function</span> <span class="fu">resetHighlight</span>(e) {</span>
<span id="cb96-3"><a href="web-visualisation.html#cb96-3" aria-hidden="true"></a>    geojson<span class="op">.</span><span class="fu">resetStyle</span>(e<span class="op">.</span><span class="at">target</span>)<span class="op">;</span></span>
<span id="cb96-4"><a href="web-visualisation.html#cb96-4" aria-hidden="true"></a>}<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// reset layout
function resetHighlight(e) {
    geojson.resetStyle(e.target);
};
</script>
<p>The <code>geojson.resetStyle</code> method will reset the layer style to its default state (defined by our style function). For this to work, make sure our <code>GeoJSON</code> layer is accessible through the <code>geojson</code> variable by defining it before our listeners and assigning the layer to it later:</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb97-1"><a href="web-visualisation.html#cb97-1" aria-hidden="true"></a><span class="co">// define variable</span></span>
<span id="cb97-2"><a href="web-visualisation.html#cb97-2" aria-hidden="true"></a><span class="kw">var</span> geojson<span class="op">;</span></span>
<span id="cb97-3"><a href="web-visualisation.html#cb97-3" aria-hidden="true"></a></span>
<span id="cb97-4"><a href="web-visualisation.html#cb97-4" aria-hidden="true"></a><span class="co">// ... event listener, reset layout function</span></span></code></pre></div>
<script type="text/javascript">
// define variable
var geojson;

// ... event listener, reset layout function

</script>
<p>As an additional touch, let’s define a <strong>click event listener</strong> that zooms to the borough:</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb98-1"><a href="web-visualisation.html#cb98-1" aria-hidden="true"></a><span class="co">// zoom to feature function</span></span>
<span id="cb98-2"><a href="web-visualisation.html#cb98-2" aria-hidden="true"></a><span class="kw">function</span> <span class="fu">zoomToFeature</span>(e) {</span>
<span id="cb98-3"><a href="web-visualisation.html#cb98-3" aria-hidden="true"></a>    cmap<span class="op">.</span><span class="fu">fitBounds</span>(e<span class="op">.</span><span class="at">target</span><span class="op">.</span><span class="fu">getBounds</span>())<span class="op">;</span></span>
<span id="cb98-4"><a href="web-visualisation.html#cb98-4" aria-hidden="true"></a>}<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// zoom to feature function
function zoomToFeature(e) {
    cmap.fitBounds(e.target.getBounds());
};
</script>
<p>Now we can use the <code>onEachFeature</code> option to add the listeners on our state layers:</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb99-1"><a href="web-visualisation.html#cb99-1" aria-hidden="true"></a><span class="co">// apply listeners on each polygon</span></span>
<span id="cb99-2"><a href="web-visualisation.html#cb99-2" aria-hidden="true"></a><span class="kw">function</span> <span class="fu">onEachFeature</span>(feature<span class="op">,</span> layer) {</span>
<span id="cb99-3"><a href="web-visualisation.html#cb99-3" aria-hidden="true"></a>    layer<span class="op">.</span><span class="fu">on</span>({</span>
<span id="cb99-4"><a href="web-visualisation.html#cb99-4" aria-hidden="true"></a>        <span class="dt">mouseover</span><span class="op">:</span> highlightFeature<span class="op">,</span></span>
<span id="cb99-5"><a href="web-visualisation.html#cb99-5" aria-hidden="true"></a>        <span class="dt">mouseout</span><span class="op">:</span> resetHighlight<span class="op">,</span></span>
<span id="cb99-6"><a href="web-visualisation.html#cb99-6" aria-hidden="true"></a>        <span class="dt">click</span><span class="op">:</span> zoomToFeature</span>
<span id="cb99-7"><a href="web-visualisation.html#cb99-7" aria-hidden="true"></a>    })<span class="op">;</span></span>
<span id="cb99-8"><a href="web-visualisation.html#cb99-8" aria-hidden="true"></a>}<span class="op">;</span></span>
<span id="cb99-9"><a href="web-visualisation.html#cb99-9" aria-hidden="true"></a></span>
<span id="cb99-10"><a href="web-visualisation.html#cb99-10" aria-hidden="true"></a><span class="co">// add London boroughs</span></span>
<span id="cb99-11"><a href="web-visualisation.html#cb99-11" aria-hidden="true"></a>geojson <span class="op">=</span> L<span class="op">.</span><span class="fu">geoJson</span>(boroughs<span class="op">,</span> {</span>
<span id="cb99-12"><a href="web-visualisation.html#cb99-12" aria-hidden="true"></a>    <span class="dt">style</span><span class="op">:</span> style<span class="op">,</span></span>
<span id="cb99-13"><a href="web-visualisation.html#cb99-13" aria-hidden="true"></a>    <span class="dt">onEachFeature</span><span class="op">:</span> onEachFeature</span>
<span id="cb99-14"><a href="web-visualisation.html#cb99-14" aria-hidden="true"></a>})<span class="op">.</span><span class="fu">addTo</span>(cmap)<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// apply listeners on each polygon
function onEachFeature(feature, layer) {
    layer.on({
        mouseover: highlightFeature,
        mouseout: resetHighlight,
        click: zoomToFeature
    });
};

// add London boroughs
geojson = L.geoJson(boroughs, {
    style: style,
    onEachFeature: onEachFeature
}).addTo(cmap);
</script>
<p>And it works:</p>
<div class="figure" style="text-align: center"><span id="fig:london-boroughs-highlight"></span>
<img src="images/w09/london-boroughs-highlight.png" alt="London borough population density choropleth." width="926" />
<p class="caption">
Figure 9.8: London borough population density choropleth.
</p>
</div>
</div>
</div>
<div id="assignment-1" class="section level3 unnumbered">
<h3>Assignment</h3>
<p>You know went through all the steps involved in creating a simple choropleth web map using Leaflet.js. The last thing you would want to add is a legend. Try this by adding the following code to your <code>choropleth.js</code> file:</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb100-1"><a href="web-visualisation.html#cb100-1" aria-hidden="true"></a><span class="co">// define legend</span></span>
<span id="cb100-2"><a href="web-visualisation.html#cb100-2" aria-hidden="true"></a><span class="kw">var</span> legend <span class="op">=</span> L<span class="op">.</span><span class="fu">control</span>({<span class="dt">position</span><span class="op">:</span> <span class="st">&#39;bottomright&#39;</span>})<span class="op">;</span></span>
<span id="cb100-3"><a href="web-visualisation.html#cb100-3" aria-hidden="true"></a></span>
<span id="cb100-4"><a href="web-visualisation.html#cb100-4" aria-hidden="true"></a><span class="co">// create legend function</span></span>
<span id="cb100-5"><a href="web-visualisation.html#cb100-5" aria-hidden="true"></a>legend<span class="op">.</span><span class="at">onAdd</span> <span class="op">=</span> <span class="kw">function</span>(map) {</span>
<span id="cb100-6"><a href="web-visualisation.html#cb100-6" aria-hidden="true"></a></span>
<span id="cb100-7"><a href="web-visualisation.html#cb100-7" aria-hidden="true"></a>    <span class="kw">var</span> div <span class="op">=</span> L<span class="op">.</span><span class="at">DomUtil</span><span class="op">.</span><span class="fu">create</span>(<span class="st">&#39;div&#39;</span><span class="op">,</span> <span class="st">&#39;info legend&#39;</span>)<span class="op">,</span></span>
<span id="cb100-8"><a href="web-visualisation.html#cb100-8" aria-hidden="true"></a>        grades <span class="op">=</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">5000</span><span class="op">,</span> <span class="dv">10000</span><span class="op">,</span> <span class="dv">15000</span><span class="op">,</span> <span class="dv">20000</span>]<span class="op">,</span></span>
<span id="cb100-9"><a href="web-visualisation.html#cb100-9" aria-hidden="true"></a>        labels <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb100-10"><a href="web-visualisation.html#cb100-10" aria-hidden="true"></a></span>
<span id="cb100-11"><a href="web-visualisation.html#cb100-11" aria-hidden="true"></a>    <span class="co">// loop through our density intervals and generate a label with a colored square for each interval</span></span>
<span id="cb100-12"><a href="web-visualisation.html#cb100-12" aria-hidden="true"></a>    div<span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="st">&#39;&lt;b class=&quot;title&quot;&gt;Population density&lt;/b&gt;&lt;br/&gt;&#39;</span><span class="op">;</span></span>
<span id="cb100-13"><a href="web-visualisation.html#cb100-13" aria-hidden="true"></a>    <span class="cf">for</span> (<span class="kw">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> grades<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb100-14"><a href="web-visualisation.html#cb100-14" aria-hidden="true"></a>        div<span class="op">.</span><span class="at">innerHTML</span> <span class="op">+=</span></span>
<span id="cb100-15"><a href="web-visualisation.html#cb100-15" aria-hidden="true"></a>            <span class="st">&#39;&lt;i style=&quot;background:&#39;</span> <span class="op">+</span> <span class="fu">getColour</span>(grades[i] <span class="op">+</span> <span class="dv">1</span>) <span class="op">+</span> <span class="st">&#39;&quot;&gt;&lt;/i&gt; &#39;</span> <span class="op">+</span></span>
<span id="cb100-16"><a href="web-visualisation.html#cb100-16" aria-hidden="true"></a>            grades[i] <span class="op">+</span> (grades[i <span class="op">+</span> <span class="dv">1</span>] <span class="op">?</span> <span class="st">&#39;&amp;ndash;&#39;</span> <span class="op">+</span> grades[i <span class="op">+</span> <span class="dv">1</span>] <span class="op">+</span> <span class="st">&#39;&lt;br&gt;&#39;</span> <span class="op">:</span> <span class="st">&#39;+&#39;</span>)<span class="op">;</span></span>
<span id="cb100-17"><a href="web-visualisation.html#cb100-17" aria-hidden="true"></a>    }</span>
<span id="cb100-18"><a href="web-visualisation.html#cb100-18" aria-hidden="true"></a></span>
<span id="cb100-19"><a href="web-visualisation.html#cb100-19" aria-hidden="true"></a>    <span class="cf">return</span> div<span class="op">;</span></span>
<span id="cb100-20"><a href="web-visualisation.html#cb100-20" aria-hidden="true"></a>}<span class="op">;</span></span>
<span id="cb100-21"><a href="web-visualisation.html#cb100-21" aria-hidden="true"></a></span>
<span id="cb100-22"><a href="web-visualisation.html#cb100-22" aria-hidden="true"></a><span class="co">// add to map</span></span>
<span id="cb100-23"><a href="web-visualisation.html#cb100-23" aria-hidden="true"></a>legend<span class="op">.</span><span class="fu">addTo</span>(cmap)<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// define legend
var legend = L.control({position: 'bottomright'});

// create legend function
legend.onAdd = function(map) {

    var div = L.DomUtil.create('div', 'info legend'),
        grades = [0, 5000, 10000, 15000, 20000],
        labels = [];

    // loop through our density intervals and generate a label with a colored square for each interval
    div.innerHTML = '<b class="title">Population density</b><br/>';
    for (var i = 0; i < grades.length; i++) {
        div.innerHTML +=
            '<i style="background:' + getColour(grades[i] + 1) + '"></i> ' +
            grades[i] + (grades[i + 1] ? '&ndash;' + grades[i + 1] + '<br>' : '+');
    }

    return div;
};

// add to map
legend.addTo(cmap);
</script>
<p>Once this is done, create a new <code>custom.css</code> file, in the same folder as your <code>index_choropleth.html</code> and <code>choropleth.js</code> files, with the following code:</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode css"><code class="sourceCode css"><span id="cb101-1"><a href="web-visualisation.html#cb101-1" aria-hidden="true"></a><span class="fu">.legend</span> {</span>
<span id="cb101-2"><a href="web-visualisation.html#cb101-2" aria-hidden="true"></a>    <span class="kw">line-height</span>: <span class="dv">18</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb101-3"><a href="web-visualisation.html#cb101-3" aria-hidden="true"></a>    <span class="kw">color</span>: <span class="cn">#555</span><span class="op">;</span></span>
<span id="cb101-4"><a href="web-visualisation.html#cb101-4" aria-hidden="true"></a>}</span>
<span id="cb101-5"><a href="web-visualisation.html#cb101-5" aria-hidden="true"></a><span class="fu">.legend</span> i {</span>
<span id="cb101-6"><a href="web-visualisation.html#cb101-6" aria-hidden="true"></a>    <span class="kw">width</span>: <span class="dv">18</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb101-7"><a href="web-visualisation.html#cb101-7" aria-hidden="true"></a>    <span class="kw">height</span>: <span class="dv">15</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb101-8"><a href="web-visualisation.html#cb101-8" aria-hidden="true"></a>    <span class="kw">float</span>: <span class="dv">left</span><span class="op">;</span></span>
<span id="cb101-9"><a href="web-visualisation.html#cb101-9" aria-hidden="true"></a>    <span class="kw">margin-right</span>: <span class="dv">8</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb101-10"><a href="web-visualisation.html#cb101-10" aria-hidden="true"></a>    <span class="kw">opacity</span>: <span class="dv">0.7</span><span class="op">;</span></span>
<span id="cb101-11"><a href="web-visualisation.html#cb101-11" aria-hidden="true"></a>}</span>
<span id="cb101-12"><a href="web-visualisation.html#cb101-12" aria-hidden="true"></a></span>
<span id="cb101-13"><a href="web-visualisation.html#cb101-13" aria-hidden="true"></a><span class="fu">.info</span> {</span>
<span id="cb101-14"><a href="web-visualisation.html#cb101-14" aria-hidden="true"></a>    <span class="kw">padding</span>: <span class="dv">6</span><span class="dt">px</span> <span class="dv">8</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb101-15"><a href="web-visualisation.html#cb101-15" aria-hidden="true"></a>    <span class="kw">font</span>: <span class="dv">14</span><span class="dt">px</span>/<span class="dv">16</span><span class="dt">px</span> Arial<span class="op">,</span> Helvetica<span class="op">,</span> <span class="dv">sans-serif</span><span class="op">;</span></span>
<span id="cb101-16"><a href="web-visualisation.html#cb101-16" aria-hidden="true"></a>    <span class="kw">background</span>: <span class="cn">white</span><span class="op">;</span></span>
<span id="cb101-17"><a href="web-visualisation.html#cb101-17" aria-hidden="true"></a>    <span class="kw">background</span>: <span class="fu">rgba(</span><span class="dv">255</span><span class="op">,</span><span class="dv">255</span><span class="op">,</span><span class="dv">255</span><span class="op">,</span><span class="dv">0.8</span><span class="fu">)</span><span class="op">;</span></span>
<span id="cb101-18"><a href="web-visualisation.html#cb101-18" aria-hidden="true"></a>    <span class="kw">box-shadow</span>: <span class="dv">0</span> <span class="dv">0</span> <span class="dv">15</span><span class="dt">px</span> <span class="fu">rgba(</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0.2</span><span class="fu">)</span><span class="op">;</span></span>
<span id="cb101-19"><a href="web-visualisation.html#cb101-19" aria-hidden="true"></a>    <span class="kw">border-radius</span>: <span class="dv">5</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb101-20"><a href="web-visualisation.html#cb101-20" aria-hidden="true"></a>}</span>
<span id="cb101-21"><a href="web-visualisation.html#cb101-21" aria-hidden="true"></a></span>
<span id="cb101-22"><a href="web-visualisation.html#cb101-22" aria-hidden="true"></a><span class="fu">.info</span> h4 {</span>
<span id="cb101-23"><a href="web-visualisation.html#cb101-23" aria-hidden="true"></a>    <span class="kw">margin</span>: <span class="dv">0</span> <span class="dv">0</span> <span class="dv">5</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb101-24"><a href="web-visualisation.html#cb101-24" aria-hidden="true"></a>    <span class="kw">color</span>: <span class="cn">#777</span><span class="op">;</span></span>
<span id="cb101-25"><a href="web-visualisation.html#cb101-25" aria-hidden="true"></a>}</span></code></pre></div>
<style type="text/css">
.legend {
    line-height: 18px;
    color: #555;
}
.legend i {
    width: 18px;
    height: 15px;
    float: left;
    margin-right: 8px;
    opacity: 0.7;
}

.info {
    padding: 6px 8px;
    font: 14px/16px Arial, Helvetica, sans-serif;
    background: white;
    background: rgba(255,255,255,0.8);
    box-shadow: 0 0 15px rgba(0,0,0,0.2);
    border-radius: 5px;
}

.info h4 {
    margin: 0 0 5px;
    color: #777;
}
</style>
<p>Link the <code>CSS file</code> by adding the following to the <code>head</code> of your HTML file:</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb102-1"><a href="web-visualisation.html#cb102-1" aria-hidden="true"></a><span class="co">&lt;!--custom css --&gt;</span></span>
<span id="cb102-2"><a href="web-visualisation.html#cb102-2" aria-hidden="true"></a><span class="kw">&lt;link</span><span class="ot"> rel=</span><span class="st">&quot;stylesheet&quot;</span><span class="ot"> href=</span><span class="st">&quot;custom.css&quot;</span> <span class="kw">/&gt;</span></span></code></pre></div>
<p>Your map is now done:</p>
<div class="figure" style="text-align: center"><span id="fig:london-boroughs-legend"></span>
<img src="images/w09/london-boroughs-legend.png" alt="London borough population density choropleth." width="926" />
<p class="caption">
Figure 9.9: London borough population density choropleth.
</p>
</div>
<p>Further experimentation:</p>
<ol style="list-style-type: decimal">
<li>Try to play with some of the settings to see how changes in the HTML, CSS, and JavaScript affect the look of your web page and web map.</li>
<li>Try to understand what is happening in the JavaScript codes that generates the legend to our map.</li>
<li>Rename your HTML file with your choropleth map to <code>index.html</code> and, together with the <code>custom.css</code> and <code>choropleth.js</code>, upload it to the <code>GEOG0125</code> server under <code>~/web</code>. If all is well, your web map will now be reflected on <a href="http://178.79.152.249/username/" class="uri">http://178.79.152.249/username/</a></li>
</ol>
</div>
</div>
<div id="web-visualisation-1" class="section level2" number="9.5">
<h2><span class="header-section-number">9.5</span> Web visualisation</h2>
<p>Web visualisation is much more than creating maps online, so in the second part of this lecture Oliver will go beyond slippy maps and talk about “raster vs vector”, <a href="https://deck.gl/">Deck.gl</a> and <a href="https://kepler.gl/">Kepler.gl</a>, <a href="https://d3js.org/">D3</a>, and <a href="https://developers.google.com/chart">Google Charts</a>.</p>
<div id="video-beyond-slippy-maps" class="section level4 unnumbered">
<h4>Video: Beyond Slippy Maps</h4>
<p><div class="vembedr" align="left">
<div>
<iframe src="https://web.microsoftstream.com/embed/video/c250880c-a2fe-4fbf-aec4-74daac423878?autoplay=false&amp;showinfo=true" width="533" height="300" style="border:none;"></iframe>
</div>
</div>
<a href="https://github.com/jtvandijk/GEOG0125/blob/master/slides/w09/w09_02_web_vis.pdf">[Lecture slides]</a> <a href="https://web.microsoftstream.com/video/c250880c-a2fe-4fbf-aec4-74daac423878">[Watch on MS stream]</a></p>
</div>
</div>
<div id="thm_w09" class="section level2" number="9.6">
<h2><span class="header-section-number">9.6</span> Take home message</h2>
<p>This week <a href="https://oobrien.com/">Oliver O’Brien</a> introduced you to web mapping and more advanced web visualisations. The practical element of this week’s material introduced you to creating an interactive web map using the <a href="https://leafletjs.com/">Leaflet.js</a> library. Leaflet is designed with simplicity, performance and usability in mind. It works efficiently across all major desktop and mobile platforms and can be extended with lots of plugins. This tutorial only covered some of the basics of using Leaflet to create maps, so by all means do have a look at the tutorials on <a href="https://leafletjs.com/examples/geojson/">Using GeoJSON with Leaflet</a> and <a href="https://leafletjs.com/examples/layers-control/">Layer Groups and Layers Control</a>.</p>
</div>
<div id="attributions_w09" class="section level2" number="9.7">
<h2><span class="header-section-number">9.7</span> Attributions</h2>
<p>Content and inspiration for this week’s material was derived from: the <em><a href="https://leafletjs.com/examples/quick-start/">Leaflet Quick Start Guide</a></em> and the <em><a href="https://leafletjs.com/examples/choropleth/">Interactive Choropleth Map Tutorial</a></em>.</p>

</div>
</div>



            </section>

          </div>
        </div>
      </div>
<a href="unix-tools.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="a-look-into-the-future.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/jtvandijk/GEOG0125_20202021/edit/master/09-week09.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["https://github.com/jtvandijk/GEOG0125_20202021/raw/master/09-week09.Rmd"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
